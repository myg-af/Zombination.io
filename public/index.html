<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Zombination.io</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; background: #222; color: white; font-family: Arial, sans-serif; }
    #gameCanvas { display: block; background: #222; position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; }
    #hudStats { position: fixed; left: 10px; bottom: 10px; background: rgba(0,0,0,0.7); border-radius: 7px; padding: 10px 20px 10px 15px; font-size: 18px; user-select: none; min-width: 210px; }
    #hudAlive { font-weight: bold; color: #fd7; }
    #deathScreen { display: none; position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; background: rgba(30,0,0,0.8); z-index: 3; justify-content: center; align-items: center; flex-direction: column; }
    #deathScreenInner { background: #181818; border-radius: 20px; padding: 35px 45px; color: #fff; box-shadow: 0 6px 30px #000c; text-align: center; min-width: 320px; }
    #deathScreen h2 { margin: 0 0 15px 0; color: #fc2c3c; }
    #deathStats { margin-bottom: 15px; font-size: 20px; }
    #btnReplay { background: #222; color: #fff; padding: 10px 32px; border: none; border-radius: 10px; font-size: 20px; cursor: pointer; transition: background 0.16s; }
    #btnReplay:hover { background: #393; color: #fff; }
    /* --- LOBBY --- */
    #lobbyScreen { display: flex; flex-direction: column; align-items: center; justify-content: center; position: fixed; left:0;top:0;width:100vw;height:100vh;z-index:10; background: #181c; }
    #lobbyBox { background: #19191e; border-radius: 20px; padding: 36px 42px; box-shadow: 0 6px 30px #000c; min-width: 350px; min-height: 190px; text-align: center; }
    #lobbyBox input[type=text] { font-size: 20px; padding: 7px 12px; border-radius: 7px; border: 1px solid #444; outline: none; margin-bottom: 10px; width: 175px; }
    #lobbyJoin { padding: 7px 32px; border-radius: 8px; border:none; font-size: 20px; background:#49c749; color: #fff; cursor: pointer; margin-top: 7px; }
    #lobbyJoin[disabled] { opacity: 0.6; cursor: not-allowed; }
    #lobbyPlayers { margin: 18px 0 12px 0; color: #9fd; }
    #lobbyTimer { font-size: 17px; margin-bottom: 9px; }
    #lobbyStatus { margin: 4px 0 0 0; color: #ccc; font-size: 14px; }

    /* --- LANG SELECT --- */
    #langSelectRow {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 13px;
      user-select: none;
    }
    .langFlag {
      width: 38px;
      height: 26px;
      border-radius: 6px;
      border: 2px solid transparent;
      cursor: pointer;
      transition: border 0.14s, transform 0.12s;
      background: #fff2;
      object-fit: cover;
      box-shadow: 0 2px 10px #0003;
    }
    .langFlag.selected {
      border: 2.5px solid #33fc69;
      transform: scale(1.07);
      box-shadow: 0 2px 16px #33fc6930;
    }

    /* --- WAVE MESSAGE --- */
    #waveMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #f2f263;
      font-size: 48px;
      font-weight: bold;
      text-shadow: 2px 2px 6px #000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.4s ease-in-out;
      z-index: 20;
      user-select: none;
    }
    /* Version */
    #versionBox {
      position: fixed;
      right: 20px;
      bottom: 14px;
      color: #ccc;
      font-size: 14px;
      opacity: 0.8;
      z-index: 20;
      user-select: none;
    }
    /* Ajout des joysticks mobile (si jamais) */
    .joystick-container {
      position: fixed;
      z-index: 50;
      touch-action: none;
      pointer-events: none;
    }
    .joystick-base, .joystick-stick {
      pointer-events: auto;
      user-select: none;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="hudStats">
    <div id="hudAlive"></div>
    <div id="hudZombies"></div>
    <div id="hudKills"></div>
    <div id="hudRound"></div>
    <div id="hudHP"></div>
  </div>
  <div id="deathScreen">
    <div id="deathScreenInner">
      <h2 id="deathTitle"></h2>
      <div id="deathStats"></div>
      <button id="btnReplay"></button>
    </div>
  </div>
  <div id="lobbyScreen">
    <div id="lobbyBox">
      <div id="lobbyTitle" style="font-size: 28px; margin-bottom: 18px;"><b>Zombination.io</b></div>
      <div id="lobbyPlayers"></div>
      <div id="lobbyTimer"></div>
      <div id="lobbyStatus"></div>
      <input type="text" id="pseudoInput" maxlength="15" placeholder="" />
      <br>
      <button id="lobbyJoin"></button>
      <div id="langSelectRow"></div>
    </div>
  </div>
  <div id="versionBox">Version 1.0.0 par Myg</div>
  <div id="waveMessage"></div>
  <script src="/translations.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // ... tout le code d’avant inchangé (lobby, détection mobile, joystick etc) ...

    // (les mêmes variables que précédemment)

    // TRAIT DE VISÉE (PATCH !)
    function drawAimLine() {
      if (!myId || !playersHealth[myId] || !playersHealth[myId].alive) return;
      const player = playersHealth[myId];
      let dir = {x: 1, y: 0};
      let show = false;

      if (isMobileDevice) {
        let len = Math.hypot(aimJoyVal.x, aimJoyVal.y);
        if (len > 18) { // On ne montre que si joystick vise vraiment
          dir = { x: aimJoyVal.x/len, y: aimJoyVal.y/len };
          show = true;
        }
      } else {
        // PC: montre le trait QUE si bouton gauche souris pressé ou souris bouge hors du joueur
        let dx = (cameraX + mousePos.x) - player.x;
        let dy = (cameraY + mousePos.y) - player.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        if (mouseDown || dist > 35) {
          dir = aimDir;
          show = true;
        }
      }
      if (!show) return;

      // TRAIT : plus long, plus fin
      const length = 220;
      const screenX = player.x - cameraX;
      const screenY = player.y - cameraY;
      ctx.save();
      ctx.beginPath();
      ctx.moveTo(screenX, screenY);
      ctx.lineTo(screenX + dir.x * length, screenY + dir.y * length);
      ctx.strokeStyle = 'rgba(255,255,0,0.66)';
      ctx.lineWidth = 2;
      ctx.shadowColor = 'yellow';
      ctx.shadowBlur = 7;
      ctx.stroke();
      ctx.restore();
    }

    // ... puis dans la gameLoop :
    function gameLoop(timestamp = 0) {
      const deltaTime = Math.max(0.008, Math.min(0.05, (timestamp - lastTime) / 1000));
      lastTime = timestamp;
      update(deltaTime);
      updateCamera();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawMap();
      drawBullets();
      drawZombies();
      drawPlayers();
      drawAimLine(); // PATCH : affiche le trait de visée conditionnel !
      drawHUD();
      if (!isDead) requestAnimationFrame(gameLoop);
    }

    // ... reste du code inchangé
  </script>
</body>
</html>
